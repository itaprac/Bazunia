<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dokumentacja — Baza Deluxe</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/components.css">
  <script src="/js/runtime-config.js"></script>
  <script>
    // Apply saved theme, color theme, and layout width from localStorage
    (function() {
      try {
        var s = JSON.parse(localStorage.getItem('baza_appSettings'));
        if (!s) return;
        if (s.colorTheme) document.documentElement.setAttribute('data-color-theme', s.colorTheme);
        if (s.layoutWidth) document.documentElement.style.setProperty('--app-max-width', s.layoutWidth);
        if (s.theme === 'dark') {
          document.documentElement.setAttribute('data-theme', 'dark');
        } else if (s.theme === 'light') {
          document.documentElement.setAttribute('data-theme', 'light');
        } else {
          var dark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
        }
      } catch(e) {}
    })();
  </script>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <a href="index.html" class="app-title">Baza Deluxe</a>
      <div id="header-app-actions">
        <input type="file" id="file-input" class="file-input-hidden" accept=".json">
        <a href="docs.html" class="btn btn-secondary btn-sm">Dokumentacja</a>
        <button class="btn btn-secondary btn-sm" id="btn-app-settings">Ustawienia</button>
      </div>
      <div class="header-auth">
        <span class="auth-user-email" id="auth-user-email">Niezalogowany</span>
        <button class="btn btn-secondary btn-sm" id="btn-auth-logout" style="display: none;">Wyloguj</button>
      </div>
    </header>

    <div class="docs-content">
      <div class="docs-layout">
        <nav class="docs-toc" aria-label="Spis treści dokumentacji">
          <div class="docs-toc-title">Spis treści</div>
          <ul>
            <li><a href="#about">Czym jest Baza Deluxe</a></li>
            <li><a href="#import">Import talii</a></li>
            <li><a href="#modes">Tryby nauki</a></li>
            <li><a href="#sm2">Algorytm SM-2</a></li>
            <li><a href="#shortcuts">Skróty klawiszowe</a></li>
            <li><a href="#settings">Ustawienia</a></li>
            <li><a href="#randomize">Losowe wartości (szablony)</a></li>
            <li><a href="#advanced-randomize">Zaawansowana randomizacja</a></li>
          </ul>
        </nav>
        <div class="docs-main">

      <!-- Section: About -->
      <section class="docs-section" id="about">
        <h2 class="docs-section-title">Czym jest Baza Deluxe</h2>
        <p>
          Baza Deluxe to aplikacja webowa do nauki z wykorzystaniem fiszek i powtarzania rozłożonego w czasie.
          Działa w przeglądarce, z dwoma zakresami talii: <strong>Ogólne</strong> (publiczne) oraz <strong>Moje</strong> (prywatne).
          W trybie gościa dane są lokalne, a po zalogowaniu dane użytkownika synchronizują się przez Supabase.
        </p>
        <p>
          Aplikacja obsługuje talie pytań wielokrotnego wyboru z wieloma poprawnymi odpowiedziami,
          kategoriami, wyjaśnieniami i trzema głównymi trybami nauki:
          Anki (powtarzanie rozłożone), Test i Przeglądanie.
        </p>
      </section>

      <!-- Section: Import -->
      <section class="docs-section" id="import">
        <h2 class="docs-section-title">Import talii</h2>
        <p>
          Zarządzanie prywatnymi taliami działa po zalogowaniu i zapisuje je w zakładce <strong>Moje</strong>.
          Możesz utworzyć talię ręcznie przyciskiem <strong>Nowa talia</strong> albo zaimportować plik JSON
          przyciskiem <strong>Importuj talię</strong>.
        </p>
        <p>
          Ponowny import tej samej talii (ten sam <code>deck.id</code>) aktualizuje pytania i dodaje nowe,
          zachowując postęp nauki kart.
        </p>

        <h3>Tworzenie talii ręcznie</h3>
        <ol>
          <li>Zaloguj się i przejdź do zakładki <strong>Moje</strong>.</li>
          <li>Kliknij <strong>Nowa talia</strong>, podaj nazwę i ID talii.</li>
          <li>Po utworzeniu talii wejdź w <strong>Przeglądanie</strong>.</li>
          <li>Kliknij <strong>+ Dodaj pytanie</strong> i zapisz pytanie.</li>
          <li>Nowe pytania możesz dodawać w dowolnym momencie, także do istniejącej talii.</li>
        </ol>

        <h3>Import w 5 krokach</h3>
        <ol>
          <li>Zaloguj się i przejdź do zakładki <strong>Moje</strong>.</li>
          <li>Kliknij <strong>Importuj talię</strong>.</li>
          <li>Wskaż plik <code>.json</code> z talią.</li>
          <li>Po poprawnym imporcie zobaczysz komunikat typu: <code>Zaimportowano "Nazwa talii": ...</code>.</li>
          <li>Talia pojawi się na liście <strong>Moje</strong> i będzie gotowa do nauki.</li>
        </ol>

        <h3>Format JSON (zgodny z aplikacją)</h3>
        <p>Plik musi mieć sekcję <code>deck</code> oraz tablicę <code>questions</code>:</p>
        <pre class="docs-code"><code>{
  "deck": {
    "id": "moja-talia",
    "name": "Nazwa talii",
    "description": "Opcjonalny opis",
    "version": 1,
    "categories": [
      { "id": "cat1", "name": "1. Kategoria pierwsza", "questionCount": 20 },
      { "id": "cat2", "name": "2. Kategoria druga", "questionCount": 15 }
    ]
  },
  "questions": [
    {
      "id": "q1",
      "text": "Treść pytania?",
      "category": "cat1",
      "answers": [
        { "id": "a", "text": "Odpowiedź A", "correct": true },
        { "id": "b", "text": "Odpowiedź B", "correct": false },
        { "id": "c", "text": "Odpowiedź C", "correct": true },
        { "id": "d", "text": "Odpowiedź D", "correct": false }
      ],
      "explanation": "Opcjonalne wyjaśnienie."
    }
  ]
}</code></pre>

        <h3>Walidacja importu (co jest wymagane)</h3>
        <ul>
          <li><code>deck.id</code> i <code>deck.name</code> są wymagane.</li>
          <li><code>deck.id</code> może zawierać tylko litery, cyfry, myślniki i podkreślenia.</li>
          <li><code>deck.id</code> nie może kolidować z identyfikatorami talii ogólnych (wbudowanych).</li>
          <li><code>questions</code> musi być niepustą tablicą.</li>
          <li>Każde pytanie musi mieć unikalne <code>id</code> i pole <code>text</code>.</li>
          <li>Jeśli pytanie ma odpowiedzi, musi mieć <code>0</code> (fiszka) albo <code>2+</code> odpowiedzi.
            Pytanie z dokładnie jedną odpowiedzią jest odrzucane.</li>
          <li>Każda odpowiedź musi mieć <code>id</code>, <code>text</code> oraz
            <code>correct</code> (boolean) lub <code>correctWhen</code> (dla dynamicznej poprawności).</li>
          <li>W pytaniu testowym musi istnieć co najmniej jedna odpowiedź poprawna.</li>
        </ul>

        <h3>Pytania typu fiszka</h3>
        <p>
          Fiszka to pytanie bez tablicy <code>answers</code> lub z pustą tablicą.
          Wtedy w trybie nauki pokazujesz odpowiedź, a potem oceniasz kartę jak w Anki.
        </p>

        <h3>Pola opcjonalne</h3>
        <ul>
          <li><code>deck.description</code>, <code>deck.version</code></li>
          <li><code>deck.categories</code> (dla widoku wyboru kategorii; każda kategoria powinna mieć <code>id</code>, <code>name</code>, <code>questionCount</code>)</li>
          <li><code>category</code> w pytaniu (ID kategorii)</li>
          <li><code>explanation</code> w pytaniu</li>
          <li><code>randomize</code> w pytaniu (losowe wartości / szablony)</li>
        </ul>

        <h3>Najczęstsze błędy importu</h3>
        <ul>
          <li>Brak sekcji <code>deck</code> albo <code>deck.id</code>/<code>deck.name</code>.</li>
          <li>Powielone identyfikatory pytań (<code>questions[*].id</code>).</li>
          <li>Pytanie z jedną odpowiedzią (musi być 0 lub minimum 2).</li>
          <li>Brak odpowiedzi poprawnej w pytaniu testowym.</li>
        </ul>

        <h3>Wbudowane talie (katalog data/)</h3>
        <p>
          Pliki JSON umieszczone w katalogu <code>data/</code> obok <code>index.html</code> są automatycznie
          ładowane przy starcie aplikacji jako talie <strong>Ogólne</strong> (publiczne). Ścieżki i identyfikatory
          wbudowanych talii są zdefiniowane w kodzie aplikacji (tablica <code>BUILT_IN_DECK_SOURCES</code> w <code>app.js</code>).
        </p>
        <p>
          Talie ogólne są tylko do nauki: można uruchamiać Anki/Test/Przeglądanie oraz ustawiać własne parametry SRS,
          ale nie można usuwać talii ani edytować ich treści.
        </p>
        <p>
          Aby dodać własną wbudowaną talię:
        </p>
        <ul>
          <li>Umieść plik JSON w katalogu <code>data/</code> (np. <code>data/moja-talia.json</code>)</li>
          <li>Dodaj wpis (id + ścieżka) do tablicy <code>BUILT_IN_DECK_SOURCES</code> w pliku <code>js/app.js</code></li>
          <li>Talia załaduje się automatycznie przy pierwszym uruchomieniu aplikacji</li>
        </ul>
        <p>
          Jeśli talia o tym samym <code>deck.id</code> już istnieje, ponowny import zaktualizuje
          pytania i doda nowe, zachowując postęp nauki.
        </p>
      </section>

      <!-- Section: Modes -->
      <section class="docs-section" id="modes">
        <h2 class="docs-section-title">Tryby nauki</h2>

        <h3>Anki — powtarzanie rozłożone</h3>
        <p>
          Główny tryb nauki oparty na algorytmie SM-2. Karty wyświetlane są w kolejności wyznaczonej
          przez algorytm. Po zobaczeniu pytania i odpowiedzi, oceniasz swoją wiedzę jednym z czterech przycisków:
          <strong>Powtórz</strong>, <strong>Trudne</strong>, <strong>Dobrze</strong>, <strong>Łatwe</strong>.
        </p>
        <p>
          Algorytm dostosowuje interwały powtórek na podstawie Twoich ocen — pytania, które znasz dobrze,
          pojawiają się coraz rzadziej, a te trudne wracają częściej.
        </p>

        <h3>Test</h3>
        <p>
          Tryb egzaminacyjny. Wybierasz liczbę pytań (suwakiem), a aplikacja losuje je z talii.
          Odpowiadasz na pytania jedno po drugim, na końcu widzisz wynik procentowy
          i przegląd poprawnych/błędnych odpowiedzi.
        </p>
        <p>
          W trybie testu możesz cofać się do poprzednich pytań przyciskiem <strong>Wstecz</strong>.
          Test nie wpływa na postęp w trybie Anki.
        </p>

        <h3>Przeglądanie</h3>
        <p>
          Lista wszystkich pytań z odpowiedziami i wyjaśnieniami. Przydatne do nauki pasywnej
          lub szybkiego sprawdzenia materiału. Dostępna wyszukiwarka pytań.
        </p>
        <p>
          W prywatnych taliach w tym widoku możesz też dodawać nowe pytania przyciskiem
          <strong>+ Dodaj pytanie</strong>.
        </p>
        <p>
          Dodatkowo, po oznaczeniu pytań flagą, pojawia się tryb <strong>Oznaczone</strong>,
          który pozwala szybko wrócić do pytań wymagających uwagi.
        </p>
      </section>

      <!-- Section: SM-2 -->
      <section class="docs-section" id="sm2">
        <h2 class="docs-section-title">Algorytm SM-2</h2>
        <p>
          Baza Deluxe implementuje algorytm SM-2 w wariancie zbliżonym do Anki.
          Każda karta przechodzi przez cztery stany:
        </p>

        <div class="docs-states">
          <div class="docs-state">
            <div class="docs-state-name">Nowa</div>
            <div class="docs-state-desc">Karta nigdy nie była uczona. Czeka w kolejce nowych kart.</div>
          </div>
          <div class="docs-state">
            <div class="docs-state-name">W nauce</div>
            <div class="docs-state-desc">Karta przechodzi przez kroki nauki (domyślnie 1 min, 10 min). Odpowiedź "Dobrze" na ostatnim kroku przechodzi kartę do stanu "Powtórka".</div>
          </div>
          <div class="docs-state">
            <div class="docs-state-name">Powtórka</div>
            <div class="docs-state-desc">Karta z wyznaczonym interwałem w dniach. Interwał rośnie po każdej poprawnej odpowiedzi.</div>
          </div>
          <div class="docs-state">
            <div class="docs-state-name">Ponowna nauka</div>
            <div class="docs-state-desc">Karta z powtórki oceniona "Powtórz" — wraca do kroków nauki, ale zachowuje historię.</div>
          </div>
        </div>

        <h3>Oceny i ich efekt</h3>
        <table class="docs-table">
          <thead>
            <tr>
              <th>Ocena</th>
              <th>Karta w nauce</th>
              <th>Karta w powtórce</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Powtórz</strong> (1)</td>
              <td>Powrót do pierwszego kroku</td>
              <td>Ease -0.20, przejście do ponownej nauki</td>
            </tr>
            <tr>
              <td><strong>Trudne</strong> (2)</td>
              <td>Powtórzenie bieżącego kroku (x1.5)</td>
              <td>Ease -0.15, interwał x1.2</td>
            </tr>
            <tr>
              <td><strong>Dobrze</strong> (3)</td>
              <td>Następny krok (lub promocja do powtórki)</td>
              <td>Interwał x ease factor</td>
            </tr>
            <tr>
              <td><strong>Łatwe</strong> (4)</td>
              <td>Natychmiastowa promocja z dłuższym interwałem</td>
              <td>Ease +0.15, interwał x ease x 1.3</td>
            </tr>
          </tbody>
        </table>

        <h3>Parametry algorytmu</h3>
        <table class="docs-table">
          <thead>
            <tr>
              <th>Parametr</th>
              <th>Domyślna wartość</th>
              <th>Opis</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Kroki nauki</td>
              <td>1, 10 min</td>
              <td>Interwały minutowe dla nowych kart</td>
            </tr>
            <tr>
              <td>Kroki ponownej nauki</td>
              <td>10 min</td>
              <td>Interwały dla kart z błędem</td>
            </tr>
            <tr>
              <td>Interwał początkowy</td>
              <td>1 dzień</td>
              <td>Pierwszy interwał po ukończeniu nauki</td>
            </tr>
            <tr>
              <td>Łatwy interwał</td>
              <td>4 dni</td>
              <td>Interwał po naciśnięciu "Łatwe"</td>
            </tr>
            <tr>
              <td>Ease startowy</td>
              <td>2.5</td>
              <td>Mnożnik interwału (rośnie/maleje z ocenami)</td>
            </tr>
            <tr>
              <td>Minimalne ease</td>
              <td>1.3</td>
              <td>Ease nie spadnie poniżej tej wartości</td>
            </tr>
            <tr>
              <td>Nowe karty dziennie</td>
              <td>20</td>
              <td>Limit nowych kart na dzień</td>
            </tr>
            <tr>
              <td>Maks. powtórek</td>
              <td>200</td>
              <td>Limit powtórek na dzień</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Section: Shortcuts -->
      <section class="docs-section" id="shortcuts">
        <h2 class="docs-section-title">Skróty klawiszowe</h2>
        <p>Domyślne skróty klawiszowe w trybie nauki (Anki). Można je zmienić w ustawieniach aplikacji.</p>
        <table class="docs-table">
          <thead>
            <tr>
              <th>Akcja</th>
              <th>Klawisz(e)</th>
              <th>Opis</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pokaż odpowiedź</td>
              <td><kbd>Spacja</kbd> / <kbd>Enter</kbd></td>
              <td>Pokazuje odpowiedź i przyciski oceny</td>
            </tr>
            <tr>
              <td>Powtórz (Again)</td>
              <td><kbd>1</kbd></td>
              <td>Ocena: nie pamiętam</td>
            </tr>
            <tr>
              <td>Trudne (Hard)</td>
              <td><kbd>2</kbd></td>
              <td>Ocena: trudne, ale pamiętam</td>
            </tr>
            <tr>
              <td>Dobrze (Good)</td>
              <td><kbd>3</kbd></td>
              <td>Ocena: poprawna odpowiedź</td>
            </tr>
            <tr>
              <td>Łatwe (Easy)</td>
              <td><kbd>4</kbd></td>
              <td>Ocena: bardzo łatwe</td>
            </tr>
            <tr>
              <td>Wybór odpowiedzi</td>
              <td><kbd>1</kbd>-<kbd>9</kbd></td>
              <td>Zaznacz odpowiedź o danym numerze (w fazie pytania)</td>
            </tr>
            <tr>
              <td>Oznacz pytanie flagą</td>
              <td><kbd>F</kbd></td>
              <td>Przełącza flagę pytania w trybie nauki</td>
            </tr>
          </tbody>
        </table>
        <p>
          Po wyświetleniu odpowiedzi <kbd>Spacja</kbd> / <kbd>Enter</kbd> działa jako "Dobrze".
        </p>
      </section>

      <!-- Section: Settings -->
      <section class="docs-section" id="settings">
        <h2 class="docs-section-title">Ustawienia</h2>

        <h3>Ustawienia aplikacji</h3>
        <p>Dostępne z poziomu strony głównej (przycisk "Ustawienia"). Obejmują:</p>
        <ul>
          <li><strong>Motyw kolorystyczny</strong> — 5 palet kolorów (Academic Noir, Ocean, Forest, Midnight, Lavender)</li>
          <li><strong>Tryb wyświetlania</strong> — Jasny, Ciemny lub Automatyczny (wg systemu)</li>
          <li><strong>Szerokość układu</strong> — 4 presety (35%, 40%, 50%, 65%) oraz własna wartość (20-100%)</li>
          <li><strong>Skróty klawiszowe</strong> — zmiana klawiszy do nawigacji w trybie nauki</li>
          <li><strong>Mieszanie odpowiedzi</strong> — losowa kolejność odpowiedzi</li>
          <li><strong>Kolejność pytań</strong> — w teście: losowa albo po kolei (wg kolejności w pliku)</li>
          <li><strong>Losowe wartości w pytaniach obliczeniowych</strong> — losowanie dla pytań z wbudowanym randomizerem</li>
          <li><strong>Oznaczone pytania w trybie Anki</strong> — czy oflagowane pytania mają trafiać do zwykłej sesji Anki</li>
        </ul>

        <h3>Ustawienia talii</h3>
        <p>Dostępne z poziomu karty talii (przycisk "Ustawienia"). Obejmują parametry algorytmu SM-2 dla danej talii:</p>
        <ul>
          <li>Nowe karty dziennie</li>
          <li>Maks. powtórek dziennie</li>
          <li>Kroki nauki i ponownej nauki (w minutach)</li>
          <li>Interwał początkowy i łatwy (w dniach)</li>
          <li>Maksymalny interwał</li>
        </ul>
        <p>
          W strefie zagrożenia można zresetować postęp talii — wszystkie karty wrócą do stanu "nowe".
        </p>

        <h3>Przechowywanie danych</h3>
        <p>
          W trybie gościa dane (talie, karty, postęp, ustawienia) są przechowywane w <code>localStorage</code>
          przeglądarki z prefiksem <code>baza_</code>. Po zalogowaniu dane są zapisywane per użytkownik w Supabase.
          Wyczyszczenie danych przeglądarki usuwa tylko dane trybu gościa.
        </p>
      </section>

      <!-- Section: Randomize Templates -->
      <section class="docs-section" id="randomize">
        <h2 class="docs-section-title">Losowe wartości (szablony)</h2>
        <p>
          Pytania mogą zawierać opcjonalne pole <code>randomize</code>, które definiuje zmienne losowe.
          Przy każdym wyświetleniu pytania losowane są nowe wartości, a w treści, odpowiedziach
          i wyjaśnieniu podstawiane są obliczone wyniki.
        </p>
        <p>
          Dla pytań opartych o pole <code>randomize</code> losowanie działa automatycznie.
          Przełącznik <strong>Losowe wartości w pytaniach obliczeniowych</strong> dotyczy
          dodatkowych, wbudowanych randomizerów zdefiniowanych w kodzie aplikacji.
        </p>

        <h3>Format pola randomize</h3>
        <pre class="docs-code"><code>{
  "id": "q1",
  "text": "Oblicz {a} + {b} = ?",
  "randomize": {
    "a": [1, 50],
    "b": [1, 50]
  },
  "answers": [
    { "id": "a", "text": "={a+b}", "correct": true },
    { "id": "b", "text": "={a-b}", "correct": false },
    { "id": "c", "text": "={a*b}", "correct": false },
    { "id": "d", "text": "42", "correct": false }
  ],
  "explanation": "Suma {a} + {b} wynosi ={a+b}"
}</code></pre>

        <h3>Definiowanie zmiennych</h3>
        <table class="docs-table">
          <thead>
            <tr>
              <th>Format</th>
              <th>Opis</th>
              <th>Przykład</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>[min, max]</code></td>
              <td>Losowy integer z zakresu (2 elementy)</td>
              <td><code>"a": [1, 100]</code></td>
            </tr>
            <tr>
              <td><code>[v1, v2, v3, ...]</code></td>
              <td>Losowy wybór z listy (3+ elementów)</td>
              <td><code>"eta": [0.5, 1.0, 2.0]</code></td>
            </tr>
          </tbody>
        </table>

        <h3>Podstawienia w tekście</h3>
        <table class="docs-table">
          <thead>
            <tr>
              <th>Składnia</th>
              <th>Opis</th>
              <th>Przykład</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>{zmienna}</code></td>
              <td>Podstawienie wartości zmiennej</td>
              <td><code>{a}</code> &rarr; <code>42</code></td>
            </tr>
            <tr>
              <td><code>={wyrażenie}</code></td>
              <td>Ewaluacja wyrażenia matematycznego</td>
              <td><code>={a+b}</code> &rarr; <code>85</code></td>
            </tr>
          </tbody>
        </table>

        <h3>Obsługiwane operacje w wyrażeniach</h3>
        <p><strong>Operatory:</strong> <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, nawiasy <code>()</code>, ujemne liczby <code>-a</code></p>
        <p><strong>Stałe:</strong> <code>PI</code> (lub <code>pi</code>) = 3.14159..., <code>E</code> (lub <code>e</code>) = 2.71828...</p>

        <table class="docs-table">
          <thead>
            <tr>
              <th>Kategoria</th>
              <th>Funkcje</th>
              <th>Przykład</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Zaokrąglanie</td>
              <td><code>round(x)</code>, <code>floor(x)</code>, <code>ceil(x)</code>, <code>trunc(x)</code></td>
              <td><code>={round(a/b)}</code></td>
            </tr>
            <tr>
              <td>Podstawowe</td>
              <td><code>abs(x)</code>, <code>sign(x)</code>, <code>min(a,b,...)</code>, <code>max(a,b,...)</code></td>
              <td><code>={abs(a-b)}</code></td>
            </tr>
            <tr>
              <td>Potęgi i pierwiastki</td>
              <td><code>pow(x,n)</code>, <code>sqrt(x)</code>, <code>cbrt(x)</code></td>
              <td><code>={sqrt(a*a + b*b)}</code></td>
            </tr>
            <tr>
              <td>Logarytmy</td>
              <td><code>log(x)</code> (ln), <code>log2(x)</code>, <code>log10(x)</code>, <code>exp(x)</code></td>
              <td><code>={log2(n)}</code></td>
            </tr>
            <tr>
              <td>Trygonometria</td>
              <td><code>sin(x)</code>, <code>cos(x)</code>, <code>tan(x)</code>, <code>asin(x)</code>, <code>acos(x)</code>, <code>atan(x)</code>, <code>atan2(y,x)</code></td>
              <td><code>={round(sin(x)*100)/100}</code></td>
            </tr>
            <tr>
              <td>Kombinatoryka</td>
              <td><code>fact(n)</code> (n!), <code>comb(n,k)</code> (C(n,k)), <code>perm(n,k)</code> (P(n,k))</td>
              <td><code>={fact(5)}</code> &rarr; 120</td>
            </tr>
            <tr>
              <td>Narzędziowe</td>
              <td><code>gcd(a,b)</code>, <code>lcm(a,b)</code>, <code>mod(a,b)</code>, <code>clamp(x,min,max)</code>, <code>frac(x)</code></td>
              <td><code>={gcd(a,b)}</code></td>
            </tr>
          </tbody>
        </table>

        <h3>Edge-case'y</h3>
        <ul>
          <li>Dzielenie przez zero &mdash; pytanie jest losowane ponownie (do 10 prób), potem wyświetlane bez zmian</li>
          <li>Wyniki zmiennoprzecinkowe &mdash; max 4 miejsca po przecinku, bez trailing zeros</li>
          <li><code>mod(a,b)</code> zawsze zwraca wynik nieujemny (modulo matematyczne, nie reszta z dzielenia)</li>
        </ul>

        <h3>Edytor randomizacji</h3>
        <p>
          W trybie edycji pytania (przycisk &#9998;) dostępna jest sekcja <strong>Losowe wartości</strong>
          z przełącznikiem on/off. Po włączeniu można dodawać i usuwać zmienne oraz definiować ich zakresy.
        </p>

        <h3>Przycisk "Wylosuj ponownie"</h3>
        <p>
          W trybie nauki (Anki), przy pytaniach z losowymi wartościami, obok przycisku edycji wyświetlany jest
          przycisk &#x1F3B2; (kość). Kliknięcie losuje nowe wartości. W trybie testu przycisk nie jest dostępny
          &mdash; wartości są stałe dla danego podejścia.
        </p>
      </section>

      <!-- Section: Advanced Randomize -->
      <section class="docs-section" id="advanced-randomize">
        <h2 class="docs-section-title">Zaawansowana randomizacja</h2>
        <p>
          System szablonow zostal rozszerzony o operatory porownania, funkcje warunkowe,
          zmienne pochodne, ograniczenia, formatowanie, zmienne tekstowe i dynamiczna poprawnosc odpowiedzi.
        </p>

        <h3>Operatory porownania</h3>
        <p>
          W wyrazeniach mozna uzywac operatorow porownania, ktore zwracaja <code>1</code> (prawda) lub <code>0</code> (falsz):
        </p>
        <table class="docs-table">
          <thead><tr><th>Operator</th><th>Opis</th><th>Przyklad</th></tr></thead>
          <tbody>
            <tr><td><code>&gt;</code></td><td>wieksze</td><td><code>={if(a &gt; b, a, b)}</code></td></tr>
            <tr><td><code>&lt;</code></td><td>mniejsze</td><td><code>a &lt; 10</code></td></tr>
            <tr><td><code>&gt;=</code></td><td>wieksze lub rowne</td><td><code>a &gt;= 0</code></td></tr>
            <tr><td><code>&lt;=</code></td><td>mniejsze lub rowne</td><td><code>a + b &lt;= 100</code></td></tr>
            <tr><td><code>==</code></td><td>rowne</td><td><code>mod(n, 2) == 0</code></td></tr>
            <tr><td><code>!=</code></td><td>rozne</td><td><code>a != b</code></td></tr>
          </tbody>
        </table>

        <h3>Funkcje warunkowe i logiczne</h3>
        <table class="docs-table">
          <thead><tr><th>Funkcja</th><th>Opis</th><th>Przyklad</th></tr></thead>
          <tbody>
            <tr><td><code>if(warunek, tak, nie)</code></td><td>Warunkowa — zwraca <code>tak</code> jesli warunek != 0, inaczej <code>nie</code></td><td><code>={if(a &gt; b, a, b)}</code> &mdash; maximum</td></tr>
            <tr><td><code>and(a, b)</code></td><td>Logiczne AND (1 jesli oba != 0)</td><td><code>and(a &gt; 0, b &gt; 0)</code></td></tr>
            <tr><td><code>or(a, b)</code></td><td>Logiczne OR (1 jesli ktorykolwiek != 0)</td><td><code>or(a == 0, b == 0)</code></td></tr>
            <tr><td><code>not(a)</code></td><td>Logiczne NOT (1 jesli a == 0)</td><td><code>not(a == b)</code></td></tr>
          </tbody>
        </table>

        <h3>Zmienne pochodne ($derived)</h3>
        <p>
          Zmienne obliczane z losowych zmiennych, w kolejnosci definicji. Dostepne we wszystkich
          wyrazeniach i podstawieniach.
        </p>
        <pre class="docs-code"><code>"randomize": {
  "a": [1, 50],
  "b": [1, 50],
  "$derived": {
    "sum": "a + b",
    "diff": "abs(a - b)",
    "bigger": "if(a > b, a, b)"
  }
}</code></pre>

        <h3>Ograniczenia ($constraints)</h3>
        <p>
          Tablica wyrazen-warunkow. Jesli ktorykolwiek nie jest spelniony, system losuje nowe wartosci
          (do 50 prob). Przydatne do unikania dzielenia przez zero, powtarzajacych sie wartosci itp.
        </p>
        <pre class="docs-code"><code>"randomize": {
  "a": [1, 20],
  "b": [1, 20],
  "$constraints": ["a != b", "a + b <= 30"]
}</code></pre>

        <h3>Formatowanie {var:format}</h3>
        <p>
          Mozna dodac specyfikator formatu po dwukropku w podstawieniu zmiennej:
        </p>
        <table class="docs-table">
          <thead><tr><th>Format</th><th>Opis</th><th>Przyklad</th><th>Wynik (dla 42)</th></tr></thead>
          <tbody>
            <tr><td><code>{a:bin}</code></td><td>Binarny</td><td><code>{n:bin}</code></td><td><code>101010</code></td></tr>
            <tr><td><code>{a:hex}</code></td><td>Szesnastkowy</td><td><code>{n:hex}</code></td><td><code>2A</code></td></tr>
            <tr><td><code>{a:oct}</code></td><td>Osemkowy</td><td><code>{n:oct}</code></td><td><code>52</code></td></tr>
            <tr><td><code>{a:roman}</code></td><td>Rzymski</td><td><code>{n:roman}</code></td><td><code>XLII</code></td></tr>
            <tr><td><code>{a:.2f}</code></td><td>2 miejsca dziesietne</td><td><code>{x:.2f}</code></td><td><code>42.00</code></td></tr>
            <tr><td><code>{a:pct}</code></td><td>Procenty (x * 100)</td><td><code>{p:pct}</code></td><td><code>4200%</code></td></tr>
          </tbody>
        </table>

        <h3>Zmienne tekstowe</h3>
        <p>
          Jesli tablica wartosci zmiennej zawiera stringi, system losuje jeden z tekstow.
          Zmienne tekstowe sa dostepne tylko przez <code>{nazwa}</code>, nie w wyrazeniach <code>={...}</code>.
        </p>
        <pre class="docs-code"><code>"randomize": {
  "unit": ["metr", "centymetr", "milimetr"],
  "n": [1, 100]
}</code></pre>
        <p>Uzycie: <code>"text": "Podaj {n} {unit} w..."</code></p>

        <h3>Dynamiczna poprawnosc (correctWhen)</h3>
        <p>
          Zamiast statycznego <code>"correct": true/false</code>, odpowiedz moze miec pole <code>"correctWhen"</code>
          z wyrazeniem. Poprawnosc jest obliczana dynamicznie po losowaniu zmiennych.
        </p>
        <pre class="docs-code"><code>"answers": [
  { "id": "a", "text": "Parzysta", "correctWhen": "mod(n, 2) == 0" },
  { "id": "b", "text": "Nieparzysta", "correctWhen": "mod(n, 2) != 0" },
  { "id": "c", "text": "Dodatnia", "correctWhen": "n > 0" },
  { "id": "d", "text": "Ujemna", "correctWhen": "n < 0" }
]</code></pre>
        <p>
          Odpowiedzi z <code>correctWhen</code> nie potrzebuja pola <code>correct</code> &mdash; jest ono ignorowane
          na rzecz wyniku wyrazenia. Jedna odpowiedz moze byc poprawna przy jednych wartosciach, a niepoprawna przy innych.
        </p>

        <h3>Pelny przyklad</h3>
        <pre class="docs-code"><code>{
  "id": "advanced-01",
  "text": "Liczba {n} w systemie binarnym to {n:bin}. Ktore stwierdzenia sa prawdziwe?",
  "randomize": {
    "n": [1, 255],
    "$derived": {
      "parity": "mod(n, 2)",
      "bits": "floor(log2(n)) + 1"
    },
    "$constraints": ["n > 0"]
  },
  "answers": [
    { "id": "a", "text": "Liczba jest parzysta", "correctWhen": "parity == 0" },
    { "id": "b", "text": "Liczba jest nieparzysta", "correctWhen": "parity != 0" },
    { "id": "c", "text": "Potrzeba ={bits} bitow", "correct": true },
    { "id": "d", "text": "Liczba jest wieksza niz 128", "correctWhen": "n > 128" }
  ]
}</code></pre>
      </section>
        </div>
      </div>
    </div>
  </div>
  <script type="module">
    import { initDocsNavigation } from './js/docs-navigation.js';
    import { isSupabaseConfigured, getCurrentSession, signOutUser } from './js/supabase.js';

    const settingsBtn = document.getElementById('btn-app-settings');
    const authEmail = document.getElementById('auth-user-email');
    const logoutBtn = document.getElementById('btn-auth-logout');

    async function syncAuthHeader() {
      if (!isSupabaseConfigured()) {
        if (authEmail) authEmail.textContent = 'Niezalogowany';
        if (logoutBtn) logoutBtn.style.display = 'none';
        return;
      }

      try {
        const session = await getCurrentSession();
        if (session?.user) {
          if (authEmail) authEmail.textContent = session.user.email || 'Zalogowany użytkownik';
          if (logoutBtn) logoutBtn.style.display = '';
          return;
        }
      } catch (e) {
        console.error('Docs auth sync failed:', e);
      }

      if (authEmail) authEmail.textContent = 'Niezalogowany';
      if (logoutBtn) logoutBtn.style.display = 'none';
    }

    if (settingsBtn) {
      settingsBtn.addEventListener('click', () => {
        window.location.href = 'index.html?open=app-settings';
      });
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', async () => {
        try {
          const { error } = await signOutUser();
          if (error) throw error;
        } catch (e) {
          console.error('Logout failed:', e);
        } finally {
          window.location.href = 'index.html';
        }
      });
    }

    syncAuthHeader();
    initDocsNavigation(document);
  </script>
</body>
</html>
